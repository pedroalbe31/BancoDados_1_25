CREATE DATABASE REGISTRO_PESSOAL;
USE REGISTRO_PESSOAL;

CREATE TABLE TIPO_DOCUMENTO_IDENTIFICACAO (
    ID_DOCUMENTO INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    DESCRICAO_DOCUMENTO VARCHAR(20)
);

CREATE TABLE NACIONALIDADE (
    ID_NACIONALIDADE INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    DESCRICAO_NACIONALIDADE VARCHAR(255)
);

CREATE TABLE ESTADO_CIVIL (
    ID_ESTADO_CIVIL INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    DESCRICAO_ESTADO_CIVIL VARCHAR(255)
);

CREATE TABLE ENDERECO (
    ID_ENDERECO INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    RUA_ENDERECO VARCHAR(100),
    NUMERO_ENDERECO INT,
    BAIRRO_ENDERECO VARCHAR(100),
    CIDADE_ENDERECO VARCHAR(100),
    UF_ENDERECO VARCHAR(100),
    PAIS_ENDERECO VARCHAR(100),
    CEP_ENDERECO VARCHAR(100)
);

CREATE TABLE SEXO (
    ID_SEXO INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    DESCRICAO_SEXO VARCHAR(255)
);

CREATE TABLE PACIENTE (
    ID_PACIENTE INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    ID_TIPO_DOCUMENTO INT,
    ID_NACIONALIDADE INT,
    ID_SEXO INT,
    ID_ESTADO_CIVIL INT,
    ID_ENDERECO INT,
    DOCUMENTO_IDENTIFICACAO VARCHAR(50),
    MATRÍCULA_PACIENTE VARCHAR(50),
    NOME_PACIENTE VARCHAR(100),
    DATA_NASCIMENTO DATE,
    FOREIGN KEY (ID_TIPO_DOCUMENTO) REFERENCES TIPO_DOCUMENTO_IDENTIFICACAO(ID_DOCUMENTO),
    FOREIGN KEY (ID_NACIONALIDADE) REFERENCES NACIONALIDADE(ID_NACIONALIDADE),
    FOREIGN KEY (ID_SEXO) REFERENCES SEXO(ID_SEXO),
    FOREIGN KEY (ID_ESTADO_CIVIL) REFERENCES ESTADO_CIVIL(ID_ESTADO_CIVIL),
    FOREIGN KEY (ID_ENDERECO) REFERENCES ENDERECO(ID_ENDERECO)
);

CREATE TABLE EMPRESA (
    ID_EMPRESA INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    CNPJ_EMPRESA VARCHAR(100),
    NOME_EMPRESA VARCHAR(255)
);

CREATE TABLE DEPARTAMENTO (
    ID_DEPARTAMENTO INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    NOME_DEPARTAMENTO VARCHAR(255),
    DESCRICAO_DEPARTAMENTO VARCHAR(255)
);

CREATE TABLE CARGO (
    ID_CARGO INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    NOME_CARGO VARCHAR(255),
    DESCRICAO_CARGO VARCHAR(255)
);

CREATE TABLE TIPO_EXAME (
    ID_TIPO_EXAME INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    DESCRICAO_EXAME VARCHAR(255)
);

CREATE TABLE DEPENDENTE (
    ID_DEPENDENTE INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    ID_TIPO_DOCUMENTO INT,
    DOCUMENTO_IDENTIFICACAO_DEPENDENTE VARCHAR(50),
    NOME_DEPENDENTE VARCHAR(100),
    DATA_NASCIMENTO_DEPENDENTE DATE,
    FOREIGN KEY (ID_TIPO_DOCUMENTO) REFERENCES TIPO_DOCUMENTO_IDENTIFICACAO(ID_DOCUMENTO)
);

CREATE TABLE PACIENTE_DEPENDENTE (
    ID_PACIENTE INT NOT NULL,
    ID_DEPENDENTE INT NOT NULL,
    ATIVO_DEPENDENTE BOOLEAN,
    DATA_FIM_DEPENDENTE DATE,
    PRIMARY KEY (ID_PACIENTE, ID_DEPENDENTE),
    FOREIGN KEY (ID_PACIENTE) REFERENCES PACIENTE(ID_PACIENTE),
    FOREIGN KEY (ID_DEPENDENTE) REFERENCES DEPENDENTE(ID_DEPENDENTE)
);

CREATE TABLE EXAMES_PACIENTE (
    ID_EXAME_PACIENTE INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    ID_PACIENTE INT,
    ID_TIPO_EXAME INT,
    ID_EMPRESA INT,
    ID_DEPARTAMENTO INT,
    ID_CARGO INT,
    DATA_MUDANCA DATE,
    DATA_EXAME DATE,
    FOREIGN KEY (ID_PACIENTE) REFERENCES PACIENTE(ID_PACIENTE),
    FOREIGN KEY (ID_TIPO_EXAME) REFERENCES TIPO_EXAME(ID_TIPO_EXAME),
    FOREIGN KEY (ID_EMPRESA) REFERENCES EMPRESA(ID_EMPRESA),
    FOREIGN KEY (ID_DEPARTAMENTO) REFERENCES DEPARTAMENTO(ID_DEPARTAMENTO),
    FOREIGN KEY (ID_CARGO) REFERENCES CARGO(ID_CARGO)
);

-- ALIMENTAÇÃO DAS TABELAS
INSERT INTO TIPO_DOCUMENTO_IDENTIFICACAO (DESCRICAO_DOCUMENTO) VALUES
('RG'), ('CPF'), ('CNH'), ('Passaporte'), ('Carteira de Trabalho'),
('RNE'), ('Título de Eleitor'), ('Certidão Nasc.'), ('Certidão Cas.'), ('Outro');

INSERT INTO NACIONALIDADE (DESCRICAO_NACIONALIDADE) VALUES
('Brasileira'), ('Argentina'), ('Chilena'), ('Uruguaia'), ('Paraguaia'),
('Peruana'), ('Boliviana'), ('Colombiana'), ('Venezuelana'), ('Mexicana');

INSERT INTO ESTADO_CIVIL (DESCRICAO_ESTADO_CIVIL) VALUES
('Solteiro'), ('Casado'), ('Divorciado'), ('Viúvo'), ('Separado'),
('União Estável'), ('Complicado'), ('Não declarado'), ('Viúvo(a)'), ('Outro');

INSERT INTO SEXO (DESCRICAO_SEXO) VALUES
('Masculino'), ('Feminino'), ('Outro'), ('Não Informado'), 
('Masculino Trans'), ('Feminino Trans'), ('Intersexo'), ('Prefiro não dizer'),
('Não Binário'), ('Desconhecido');

INSERT INTO ENDERECO (RUA_ENDERECO, NUMERO_ENDERECO, BAIRRO_ENDERECO, CIDADE_ENDERECO, UF_ENDERECO, PAIS_ENDERECO, CEP_ENDERECO) VALUES
('Rua A', 10, 'Centro', 'São Paulo', 'SP', 'Brasil', '01001-000'),
('Rua B', 20, 'Jardins', 'São Paulo', 'SP', 'Brasil', '01415-002'),
('Rua C', 30, 'Moema', 'São Paulo', 'SP', 'Brasil', '04077-000'),
('Av. Brasil', 100, 'Copacabana', 'Rio de Janeiro', 'RJ', 'Brasil', '22070-001'),
('Rua D', 5, 'Centro', 'Belo Horizonte', 'MG', 'Brasil', '30130-001'),
('Rua E', 45, 'Aldeota', 'Fortaleza', 'CE', 'Brasil', '60175-075'),
('Rua F', 12, 'Boa Viagem', 'Recife', 'PE', 'Brasil', '51020-020'),
('Rua G', 78, 'Centro', 'Curitiba', 'PR', 'Brasil', '80010-100'),
('Rua H', 91, 'Centro', 'Porto Alegre', 'RS', 'Brasil', '90010-001'),
('Rua I', 200, 'Centro', 'Manaus', 'AM', 'Brasil', '69005-070');

INSERT INTO PACIENTE (
    ID_TIPO_DOCUMENTO, ID_NACIONALIDADE, ID_SEXO, ID_ESTADO_CIVIL, ID_ENDERECO,
    DOCUMENTO_IDENTIFICACAO, MATRÍCULA_PACIENTE, NOME_PACIENTE, DATA_NASCIMENTO
) VALUES
(1,1,1,1,1,'123456789','M0001','Carlos Silva','1985-03-10'),
(2,2,2,2,2,'987654321','M0002','Ana Souza','1990-05-20'),
(3,3,1,3,3,'111222333','M0003','João Mendes','1982-12-30'),
(4,4,2,4,4,'444555666','M0004','Maria Lima','1975-07-15'),
(5,5,1,1,5,'777888999','M0005','Pedro Costa','1995-01-01'),
(6,6,2,2,6,'000111222','M0006','Luciana Alves','1988-10-10'),
(7,7,1,3,7,'333444555','M0007','Roberto Dias','1970-02-25'),
(8,8,2,4,8,'666777888','M0008','Fernanda Rocha','1992-11-11'),
(9,9,1,5,9,'999000111','M0009','André Martins','1983-08-18'),
(10,10,2,1,10,'555666777','M0010','Juliana Reis','1998-06-30');

INSERT INTO EMPRESA (CNPJ_EMPRESA, NOME_EMPRESA) VALUES
('12345678000101','Corporação A'), ('22345678000102','Corporação B'), ('32345678000103','Corporação C'),
('42345678000104','Corporação D'), ('52345678000105','Corporação E'), ('62345678000106','Corporação F'),
('72345678000107','Corporação G'), ('82345678000108','Corporação H'), ('92345678000109','Corporação I'),
('02345678000100','Corporação J');

INSERT INTO DEPARTAMENTO (NOME_DEPARTAMENTO, DESCRICAO_DEPARTAMENTO) VALUES
('Recursos Humanos', 'Gestão de Pessoas'), 
('Tecnologia da Informação', 'Desenvolvimento e Suporte Técnico'), 
('Financeiro', 'Gestão de Contas e Fluxo de Caixa'),
('Marketing', 'Publicidade e Estratégias de Mídia'), 
('Jurídico', 'Assessoria Legal e Consultoria Jurídica'), 
('Suprimentos', 'Aquisição e Logística de Materiais'),
('Comercial', 'Vendas e Atendimento ao Cliente'), 
('Fabricação', 'Processos de Produção e Montagem'), 
('Qualidade', 'Controle de Qualidade e Auditoria'),
('Logística', 'Gestão de Transporte e Armazenagem');

INSERT INTO CARGO (NOME_CARGO, DESCRICAO_CARGO) VALUES
('Analista de Processos', 'Responsável por otimizar processos internos'),
('Desenvolvedor de Sistemas', 'Desenvolve, testa e mantém sistemas de TI'),
('Gerente de Departamento', 'Coordena e gerencia o funcionamento do departamento'),
('Assistente Administrativo', 'Suporte geral nas atividades administrativas'),
('Coordenador de Equipe', 'Lidera e organiza atividades de equipe'),
('Técnico de Campo', 'Atua diretamente no atendimento ao cliente e suporte técnico'),
('Engenheiro de Produção', 'Desenvolve e melhora processos de produção'),
('Estagiário de TI', 'Apoia nas atividades de infraestrutura e desenvolvimento'),
('Supervisor de Operações', 'Supervisiona as operações diárias e melhora a eficiência'),
('Diretor Executivo', 'Responsável pela gestão estratégica da empresa');

INSERT INTO TIPO_EXAME (DESCRICAO_EXAME) VALUES
('Exame Admissional'), 
('Exame Demissional'), 
('Exame Periódico'), 
('Audiometria'), 
('Raio-X'), 
('Hemograma'), 
('Psicotécnico'), 
('Acuidade Visual'),
('Exame Clínico'), 
('Eletrocardiograma');

INSERT INTO DEPENDENTE (
    ID_TIPO_DOCUMENTO, DOCUMENTO_IDENTIFICACAO_DEPENDENTE, NOME_DEPENDENTE, DATA_NASCIMENTO_DEPENDENTE
) VALUES
(1,'D001','Lucas Silva','2010-01-01'), 
(2,'D002','Beatriz Souza','2012-05-10'),
(3,'D003','Rafael Lima','2008-08-20'), 
(4,'D004','Camila Mendes','2005-07-30'),
(5,'D005','Eduardo Costa','2011-03-15'), 
(6,'D006','Isabela Alves','2009-11-11'),
(7,'D007','Tiago Dias','2007-02-22'), 
(8,'D008','Larissa Rocha','2006-06-06'),
(9,'D009','Mateus Martins','2013-09-19'), 
(10,'D010','Sofia Reis','2014-12-24');

INSERT INTO PACIENTE_DEPENDENTE (
    ID_PACIENTE, ID_DEPENDENTE, ATIVO_DEPENDENTE, DATA_FIM_DEPENDENTE
) VALUES
(1,1,TRUE,NULL), 
(2,2,TRUE,NULL), 
(3,3,TRUE,NULL), 
(4,4,FALSE,'2022-01-01'),
(5,5,TRUE,NULL), 
(6,6,TRUE,NULL), 
(7,7,FALSE,'2021-06-10'), 
(8,8,TRUE,NULL),
(9,9,TRUE,NULL), 
(10,10,TRUE,NULL);

INSERT INTO EXAMES_PACIENTE (
    ID_PACIENTE, ID_TIPO_EXAME, ID_EMPRESA, ID_DEPARTAMENTO, ID_CARGO,
    DATA_MUDANCA, DATA_EXAME
) VALUES
(1,1,1,1,1,'2023-01-01','2023-01-10'),
(2,2,2,2,2,'2023-02-01','2023-02-10'),
(3,3,3,3,3,'2023-03-01','2023-03-10'),
(4,4,4,4,4,'2023-04-01','2023-04-10'),
(5,5,5,5,5,'2023-05-01','2023-05-10'),
(6,6,6,6,6,'2023-06-01','2023-06-10'),
(7,7,7,7,7,'2023-07-01','2023-07-10'),
(8,8,8,8,8,'2023-08-01','2023-08-10'),
(9,9,9,9,9,'2023-09-01','2023-09-10'),
(10,10,10,10,10,'2023-10-01','2023-10-10');

-- SELECTS PARA APRESENTAÇÃO

-- 1. Lista de pacientes com nacionalidade, sexo e estado civil
SELECT
  P.NOME_PACIENTE AS PACIENTE,
  N.DESCRICAO_NACIONALIDADE AS NACIONALIDADE,
  S.DESCRICAO_SEXO AS SEXO,
  EC.DESCRICAO_ESTADO_CIVIL AS ESTADO_CIVIL
FROM PACIENTE P
JOIN NACIONALIDADE N ON P.ID_NACIONALIDADE = N.ID_NACIONALIDADE
JOIN SEXO S ON P.ID_SEXO = S.ID_SEXO
JOIN ESTADO_CIVIL EC ON P.ID_ESTADO_CIVIL = EC.ID_ESTADO_CIVIL;

-- 2. Exames realizados por paciente, com empresa e tipo de exame
SELECT
  P.NOME_PACIENTE AS PACIENTE,
  E.NOME_EMPRESA AS EMPRESA,
  T.DESCRICAO_EXAME AS TIPO_EXAME,
  EP.DATA_EXAME
FROM EXAMES_PACIENTE EP
JOIN PACIENTE P ON EP.ID_PACIENTE = P.ID_PACIENTE
JOIN EMPRESA E ON EP.ID_EMPRESA = E.ID_EMPRESA
JOIN TIPO_EXAME T ON EP.ID_TIPO_EXAME = T.ID_TIPO_EXAME;

-- 3. Dependentes ativos dos pacientes
SELECT
  P.NOME_PACIENTE AS PACIENTE,
  D.NOME_DEPENDENTE AS DEPENDENTE,
  PD.ATIVO_DEPENDENTE,
  PD.DATA_FIM_DEPENDENTE
FROM PACIENTE_DEPENDENTE PD
JOIN PACIENTE P ON PD.ID_PACIENTE = P.ID_PACIENTE
JOIN DEPENDENTE D ON PD.ID_DEPENDENTE = D.ID_DEPENDENTE
WHERE PD.ATIVO_DEPENDENTE = TRUE;

-- 4. Quantidade de pacientes por estado civil
SELECT
  EC.DESCRICAO_ESTADO_CIVIL AS ESTADO_CIVIL,
  COUNT(*) AS TOTAL
FROM PACIENTE P
JOIN ESTADO_CIVIL EC ON P.ID_ESTADO_CIVIL = EC.ID_ESTADO_CIVIL
GROUP BY EC.DESCRICAO_ESTADO_CIVIL;

-- 5. Exames realizados na empresa 'Corporação A'
SELECT
  P.NOME_PACIENTE AS PACIENTE,
  E.NOME_EMPRESA AS EMPRESA,
  T.DESCRICAO_EXAME AS EXAME,
  EP.DATA_EXAME
FROM EXAMES_PACIENTE EP
JOIN PACIENTE P ON EP.ID_PACIENTE = P.ID_PACIENTE
JOIN EMPRESA E ON EP.ID_EMPRESA = E.ID_EMPRESA
JOIN TIPO_EXAME T ON EP.ID_TIPO_EXAME = T.ID_TIPO_EXAME
WHERE E.NOME_EMPRESA = 'Corporação A';
